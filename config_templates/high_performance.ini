# =========================================================================
# High-Performance Configuration Template  
# =========================================================================
# This configuration is optimized for high-throughput environments with:
# - Maximum performance settings
# - Aggressive load shedding
# - Minimal overhead features
# - Optimized for 10,000+ logs/second processing
# =========================================================================

# Basic application settings
log_source_type = "mongodb"
log_input_path = "/data/high_volume/input.log"
reader_state_path = "/data/high_volume/reader_state.dat"
allowlist_path = "/etc/anomaly_detector/allowlist.txt"
alerts_to_stdout = false
alerts_to_file = true
alert_output_path = "/data/high_volume/alerts.json"

# High-performance alert settings
alert_throttle_duration_seconds = 600  # Longer throttling for high volume
alert_throttle_max_alerts = 5          # Fewer alerts to reduce overhead

# Optimized state management
state_persistence_enabled = true
state_file_path = "/data/high_volume/engine_state.dat"
state_save_interval_events = 100000    # Less frequent saves for performance
state_pruning_enabled = true
state_ttl_seconds = 86400              # 24 hours
state_prune_interval_events = 200000

# Minimal monitoring for performance
live_monitoring_enabled = false
live_monitoring_sleep_seconds = 60

# ML data collection disabled for performance
ml_data_collection_enabled = false

[Tier1]
enabled = true
# High-volume thresholds
max_requests_per_ip_in_window = 1000   # Higher limits for high volume
max_failed_logins_per_ip_in_window = 50
# Optimized scoring to reduce CPU
score_missing_ua = 5.0
score_outdated_browser = 10.0
score_known_bad_ua = 75.0
score_headless_browser = 40.0
score_ua_cycling = 85.0
score_suspicious_path = 95.0
score_sensitive_path_new_ip = 80.0

[Tier2]
enabled = false                        # Disabled for maximum performance

[Tier3]
enabled = false                        # Disabled for maximum performance

[Alerting]
file_enabled = true
syslog_enabled = false                 # Disabled for performance
http_enabled = false                   # Disabled for performance

[ThreatIntel]
enabled = false                        # Disabled for performance

[MongoLogSource]
uri = "mongodb://mongo-cluster:27017/?readPreference=secondaryPreferred"
database = "logs"
collection = "access"
timestamp_field_name = "timestamp"

[Logging]
# Minimal logging for performance
console_enabled = false
file_enabled = true
file_path = "/var/log/anomaly_detector/anomaly_detector.log"
max_file_size_mb = 200
max_files = 5
log_level = "WARN"                     # Minimal logging
json_format = false                    # Faster format
enable_function_logging = false       # Disabled for performance
enable_performance_logging = false    # Disabled for performance
enable_memory_logging = false         # Disabled for performance

[Monitoring]
enable_deep_timing = false            # Disabled for performance
web_server_host = "0.0.0.0"
web_server_port = 9091

[Prometheus]
enabled = true
host = "0.0.0.0"
port = 9090
metrics_path = "/metrics"
health_path = "/health"
scrape_interval_seconds = 30          # Less frequent for performance
replace_web_server = true
max_metrics_age_seconds = 60          # Shorter retention for performance

[DynamicLearning]
enabled = false                       # Disabled for maximum performance

[Tier4]
enabled = false                       # Disabled for maximum performance

[MemoryManagement]
enabled = true
max_memory_usage_mb = 4096            # High memory limit
memory_pressure_threshold_mb = 3200
enable_object_pooling = true          # Critical for performance
eviction_check_interval_seconds = 120 # Less frequent checks
eviction_threshold_percent = 85.0     # Higher threshold
enable_memory_compaction = false      # Disabled for performance
state_object_ttl_seconds = 7200       # Longer TTL for performance

[PerformanceMonitoring]
enabled = true
enable_profiling = false              # Disabled for performance
enable_load_shedding = true           # Critical for high volume

# High-performance metrics settings
metrics_collection_interval_ms = 2000 # Less frequent collection
max_latency_samples_per_component = 1000  # Fewer samples

# Aggressive performance thresholds
max_cpu_usage_percent = 75.0          # Lower threshold for load shedding
max_memory_usage_bytes = 4294967296   # 4GB
max_queue_depth = 50000               # Higher queue depth
max_avg_latency_ms = 100              # Very strict latency
max_error_rate_percent = 1.0          # Very low error tolerance

# Aggressive load shedding
moderate_load_shed_percentage = 20.0
high_load_shed_percentage = 40.0
critical_load_shed_percentage = 70.0

monitoring_loop_interval_seconds = 10 # Less frequent monitoring

# Profiling disabled for performance
enable_function_profiling = false
max_profile_samples_per_function = 500
profile_report_interval_seconds = 1200

# Minimal performance reporting
enable_performance_reports = false    # Disabled for performance
performance_report_path = "/dev/null"
performance_report_interval_seconds = 300

[ErrorHandling]
enabled = true

# Fast-fail circuit breaker for performance
enable_circuit_breaker = true
circuit_breaker_failure_threshold = 3  # Quick failure detection
circuit_breaker_timeout_ms = 1000      # Short timeout
circuit_breaker_recovery_timeout_ms = 10000

# Minimal retry for performance
enable_error_recovery = true
max_retry_attempts = 1                 # Minimal retries
initial_retry_delay_ms = 50
max_retry_delay_ms = 1000
retry_backoff_multiplier = 1.5

# Quick degradation for performance
enable_graceful_degradation = true
cpu_threshold_for_degradation = 70.0  # Early degradation
memory_threshold_for_degradation_mb = 3500
queue_depth_threshold_for_degradation = 40000
error_rate_threshold_for_degradation = 2.0

# Performance-optimized recovery strategies
default_recovery_strategy = "FAIL_FAST"
prometheus_recovery_strategy = "FAIL_FAST"
database_recovery_strategy = "CIRCUIT_BREAK"
file_io_recovery_strategy = "FAIL_FAST"
network_recovery_strategy = "FAIL_FAST"

# Strict error rate limiting
enable_error_rate_limiting = true
max_errors_per_minute = 50             # Lower limit
error_burst_limit = 5                  # Small burst

# Minimal recovery monitoring
recovery_statistics_interval_seconds = 300
log_recovery_attempts = false
recovery_log_level = "ERROR"           # Only errors
